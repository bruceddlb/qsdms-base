/**************导出 状态提示功能 add by bruced  begin**********************************/var iscompleted = !0; function htmlToElement(a) { var b = document.createElement("div"); b.innerHTML = a; a = b.firstChild; b.removeChild(a); return a } function createIframe(a) { var b = htmlToElement('\x3ciframe src\x3d"javascript:false" name\x3d"' + a + '" /\x3e'); b.setAttribute("id", a); b.style.display = "none"; return b } function getIframeDocument(a) { return a.contentDocument ? a.contentDocument : a.contentWindow.document } function createForm(a, b, d) { var c = htmlToElement('\x3cform method\x3d"post" lang\x3d"ca" enctype\x3d"multipart/form-data"\x3e\x3c/form\x3e'); c.setAttribute("action", b); c.setAttribute("target", a.getAttribute("name")); a = createInput("cacheid", "cacheid", "hidden"); a.setAttribute("value", d); c.appendChild(a); d = createInput("bruced", "bruced", "submit"); c.appendChild(d); return c } function createInput(a, b, d) { var c = document.createElement("input"); c.setAttribute("id", a); c.setAttribute("name", b); c.setAttribute("type", d); return c } function doProgressExport(a, b, d, c) { $("#" + c).fadeIn(); if (!iscompleted) return $("#" + d).show("fast"), setTimeout(function () { $("#" + d).hide("fast") }, 3E3), !1; iscompleted = !1; var h = createIframe("exportIframe"), l = createIframe("iframeTarget"), e = "cacheid_" + 1E8 * Math.random(); b = createForm(l, b, e); if (a) { a = a.split("$$"); for (var k = 0; k < a.length; k++) { var g = a[k].split("|"), f = g[0], g = g[1], f = createInput(f, f, "hidden"); f.setAttribute("value", encodeURI(g)); b.appendChild(f) } } document.body.appendChild(h); h.appendChild(l); h.appendChild(b); b.submit(); $("#" + c).html("\x3cspan class\x3d'' style\x3d'color:#FF6600;'\x3e\x3cimg src\x3d'/Content/Images/stateloading.gif' alt\x3d'\u52a0\u8f7d\u4e2d' style\x3d'height:20px;width:20px;vertical-align:-6px;' class\x3d'ml mr' /\x3e\u6b63\u5728\u6267\u884c...\x3c/span\x3e"); var m = function () { $.ajax({ type: "POST", cache: !1, url: "/Resources/Ajax/AjaxImportState.ashx", data: { action: "queryProcessing", cacheid: e }, success: function (a) { var b = a.split("|")[0]; a.split("|"); a.split("|"); switch (b) { case "processing": $("#" + c).html("\x3cspan style\x3d'color:#FF6600;'\x3e\x3cimg src\x3d'/Content/Images/stateloading.gif' alt\x3d'\u52a0\u8f7d\u4e2d' style\x3d'height:20px;width:20px;vertical-align:-6px;' class\x3d'ml mr' /\x3e\u6b63\u5728\u5904\u7406...\x3c/span\x3e"); b = "processing"; setTimeout(m, 2E3); break; case "IsBackground": $("#" + c).html("\x3cfont color\x3d'#4ab618'\x3e\u7a0b\u5e8f\u540e\u53f0\u5904\u7406\u4e2d...\x3c/font\x3e"); $.get("/Resources/Ajax/AjaxImportState.ashx", { action: "removeCache", cacheid: e }); b = "IsBackground"; e = "cache" + 1E8 * Math.random(); iscompleted = !0; setTimeout(function () { $("#" + c).fadeOut() }, 2E3); break; case "done": $("#" + c).html("\x3cfont color\x3d'#4ab618'\x3e\u5904\u7406\u5b8c\u6bd5...\x3c/font\x3e"); $.get("/Resources/Ajax/AjaxImportState.ashx", { action: "removeCache", cacheid: e }); b = "done"; e = "cache" + 1E8 * Math.random(); iscompleted = !0; setTimeout(function () { $("#" + c).fadeOut() }, 2E3); break; default: e = "cache" + 1E8 * Math.random(), b = "error", $("#" + c).html("\x3cfont color\x3d'red'\x3e\u6570\u636e\u5904\u7406\u5931\u8d25,\u64cd\u4f5c\u672a\u5b8c\u6210\x3c/font\x3e"), iscompleted = !0 } }, error: function (a) { alert(a.responseText) } }) }; setTimeout(m, 100) };